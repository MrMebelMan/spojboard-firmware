; PlatformIO Project Configuration File
; SpojBoard - Smart Panel for Onward Journeys
;
; For Adafruit MatrixPortal ESP32-S3 with HUB75 LED Matrix

[env:adafruit_matrixportal_esp32s3]
platform = espressif32
board = adafruit_matrixportal_esp32s3
framework = arduino

; Memory optimization - Custom OTA partitions (2MB app0 + 2MB app1)
board_build.partitions = partitions_custom.csv

lib_deps =
    ; HUB75 LED Matrix Driver
    https://github.com/mrfaptastic/ESP32-HUB75-MatrixPanel-DMA.git
    ; JSON parsing
    bblanchon/ArduinoJson@^6.21.3
    ; Adafruit GFX (required by display library)
    adafruit/Adafruit GFX Library@^1.11.9
    ; Telnet debugging
    https://github.com/LennartHennigs/ESPTelnet.git

; Build scripts
extra_scripts =
    pre:scripts/build_timestamp.py
    post:scripts/post_build.py

; Build flags
build_flags =
    -DCORE_DEBUG_LEVEL=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -Wno-deprecated-declarations

; Serial monitor
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Upload settings
upload_speed = 921600

; =============================================================================
; Adafruit Matrix Portal M4 (SAMD51 + ESP32 WiFi coprocessor)
; =============================================================================
[env:adafruit_matrix_portal_m4]
platform = atmelsam
board = adafruit_matrix_portal_m4
framework = arduino

lib_deps =
    ; HUB75 LED Matrix Driver for M4
    adafruit/Adafruit Protomatter@^1.6.0
    ; JSON parsing
    bblanchon/ArduinoJson@^6.21.3
    ; Adafruit GFX (required by display library)
    adafruit/Adafruit GFX Library@^1.11.9
    ; WiFi via ESP32 coprocessor
    arduino-libraries/WiFiNINA@^1.8.14
    ; HTTP client for M4
    arduino-libraries/ArduinoHttpClient@^0.6.1
    ; Flash storage for config persistence
    khoih-prog/FlashStorage_SAMD@^1.3.2
    ; NTP time sync
    arduino-libraries/NTPClient@^3.2.1

; Ignore ALL conflicting WiFi libraries
lib_ignore =
    WiFiNINA_Generic
    WiFi101_Generic
    WiFi101
    WiFiEspAT
    WiFiWebServer
    WiFiMulti_Generic

; Exclude ESP32-only source files from M4 build
build_src_filter =
    +<*>
    -<api/BvgAPI.cpp>
    -<network/GitHubOTA.cpp>

; Build flags
build_flags =
    -DMATRIX_PORTAL_M4
    -Wno-deprecated-declarations

; Serial monitor
monitor_speed = 115200